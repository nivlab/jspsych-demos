<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>

<title>Vocabulary Test</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    
    <SCRIPT language="Javascript">
   <!--

 

testOptions = new Array("BEAST","ADHESIVE","DREARY","MEAGER","ADHERENCE","DEPRECATE","HALCYON","PACHYDERM","TRUTH","REJOICE","POTATION","PIQUANT","ACOLYTE","COVENANT","DORMANT","CRUEL","HERMETIC","CHUCKLE","ABBATTOIR","VITTLES","SKIRMISH");

trialTypes = new Array("prac","test","test","test","test","test","test","test","test","test","test","test","test","test","test","test","test","test","test","test","test");

options1 = new Array("afraid","glue","old","level","existence","quit","plain","giraffe","neighbor","conserve","disappearance","expert","musician","pact","insane","mobile","completely sealed","laugh","hawk","conversation","compete");

options2 = new Array("words","puissance","bloom","burnt","devotion","clean","eclectic","ostrich","criminal","risk","drink","steam","savior","noise","latent","pliant","purple","haul","killing place","avoidance","travel");

options3 = new Array("large","tradition","gloomy","new","relation","hate","inhumane","platypus","midnight","revel","farming","nosy","church helper","agent","swimming","pensive","reclusive","valuable","slot","belief","sail");

options4=new Array("animal","argument","correct","bare","slippery","save","stirring","elephant","offering","automatic","rivalry","flavorful","manager","ceremony","cave","mean","princely","stub","culprit","prayer","absentee");

options5=new Array("separate","latent","possible","peevish","proof","help","peaceful","whale","fact","slash","game","hurt","speak","aria","mortal","passive","peppery","prod","stronghold","food","fight");


correctResponses = new Array(4,1,3,4,2,3,5,4,5,3,2,4,3,1,2,4,1,1,2,5,5);  

/**** ADDED THIS ******/

all_results = new Array();

/***** TO HERE ******/

var final_results;
experiment_status = new Array("");
var escape_code = 27;
var escape_code_alt = 113;
var spacebar_code =32;

accuracy = new Array();
response = new Array();
rt = new Array();

var trialNumber = 0;
var totalTrials = 21;
totalResults = new Array();
var timerID;
var correct = 0;
var begin_time = new Date();

var trialStartTime; 
var trialEndTime;

function trial_begin()
    {     
    document.getElementById('alert_response').innerHTML = "";
      present_options(trialNumber);
      trialStartTime = new Date();  //this must be kept global so the subroutine below can get it.
      var thisTrial = trialTypes[trialNumber]
     document.getElementById('targetWord').innerHTML = testOptions[trialNumber];
     if (thisTrial == "prac")
	{
	  document.getElementById('Response').style.visibility="visible";
	  document.onkeyup = getKeyOther;
	}
      else if (thisTrial=="test")
	{
		document.getElementById('instructions').innerHTML = "Select the word that comes closest to the meaning of the word in capital letters.";
	document.getElementById('Practice').innerHTML = trialNumber+" of 20";
	document.getElementById('Response').style.visibility="visible";
	  document.onkeyup = getKeyOther;
	}
    }
    

function getKeyOther(keyStroke) {
	isNetscape=(document.layers);
  keyID = (window.event) ? event.keyCode : keyStroke.keyCode;
  eventChooser = (isNetscape) ? keyStroke.which : keyID;
  which = String.fromCharCode(eventChooser);
  if (eventChooser == escape_code || eventChooser == escape_code_alt) {quit_routine(false);}
}

function quit_routine(cleanp)
{
  if (cleanp) {
    save_data();
  } else {
    var answer = confirm ("Are you sure you want to quit? If so, you will not be allowed to try again.") 
      if (answer) {
	experiment_status[trialNumber] = "terminated";
	save_data();
      } else {
	experiment_status[trialNumber] = "paused";	
	clearTimeout(timerID);
	trial_begin();
      } 
  }
}

function present_options(thistrial) {
document.getElementById("first_word").checked = false;
document.getElementById("second_word").checked = false;
document.getElementById("third_word").checked = false;
document.getElementById("fourth_word").checked = false;
document.getElementById("fifth_word").checked = false;

document.getElementById("word1").innerHTML = options1[thistrial];
document.getElementById("word2").innerHTML = options2[thistrial];
document.getElementById("word3").innerHTML = options3[thistrial];
document.getElementById("word4").innerHTML = options4[thistrial];
document.getElementById("word5").innerHTML = options5[thistrial];
  
  }  

function process_response()
{
var select_index = $('.word_check:checked').val();
  if (!select_index) {
    document.getElementById('alert_response').innerHTML = "You must select one of the five words from the list.";
  } else {
  	  trialEndTime = new Date();
  	  rt[trialNumber] = trialEndTime - trialStartTime;
	  if (trialTypes[trialNumber] == "prac") {
		  if (select_index == correctResponses[trialNumber]) {
			  accuracy[trialNumber] = 1;
		  } else {
			  accuracy[trialNumber] = 0;
			  alert("The correct answer for this practice item was actually 'animal'. You will receive no feedback from here on.");
		  }
	  } else {
		  if (select_index == correctResponses[trialNumber]) {
			  accuracy[trialNumber] = 1;
			  response[trialNumber] = select_index;
			  correct = correct + 1;
		  } else {
			  accuracy[trialNumber] = 0;
			  response[trialNumber] = select_index;
		  }
	  }
	 /*** ADDED THIS ****/
	  all_results.push({
	  		  type:trialTypes[trialNumber],
	  		  accuracy:accuracy[trialNumber],
	  		  response:response[trialNumber]
	  });
	  /**** TO HERE ****/
    trial_end();
  }
}



function save_data() {

	/****** ADDED THIS ******/
	document.getElementById('data').value = JSON.stringify(all_results);
	document.getElementById('score').value = correct;
	document.getElementById('form').submit();
	//console.log(document.getElementById('score').value);
	//console.log(document.getElementById('data').value);
	/***** TO HERE ****/
	
	
}

    function trial_end()
    {
    if (trialNumber >= (totalTrials-1)) 
      {
	quit_routine(true);	
      }
    else
      {
	trialNumber++;
	trial_begin();
    }
    }

      
      //-->
    </SCRIPT>
    
    </head>
    
    <body>
    
    <div style="visibility:visible; margin: 0 auto; text-align:center">
    <div style="height:10%;color:red">DO NOT PRESS BACK OR RELOAD, or you will have to start the experiment again.</div>
    <div id="Practice" style="font-weight:bold; font-size:1.3em; margin:20px"></div>
    
    <p style="font-size:1.1em;width:600px; margin:0 auto; text-align:center" id="instructions" name="instructions"> 
    Vocabulary<br><br>
    Select the word that comes closest to the meaning of the word in capital letters.<br>
</p>
    <div id="targetWord" name="targetWord" style="font-size:1.3em;margin:20px">BEAST</div>
    <div id="Response" style="margin: 0 auto; text-align:center">
    <form name="ResponseSelect">
    


	

    <p><label><input type="radio" name="Word" id="first_word" class="word_check" value=1> <span id="word1">afraid</span></label><br>
<label><input type="radio" name="Word" id="second_word" class="word_check" value=2> <span id="word2">words</span></label><br>
<label><input type="radio" name="Word" id="third_word" class="word_check" value=3> <span id="word3">large</span></label><br>
<label><input type="radio" name="Word" id="fourth_word" class="word_check" value=4> <span id="word4">animal</span></label><br>
<label><input type="radio" name="Word" id="fifth_word" class="word_check" value=5> <span id="word5">separate</span></label></p><br>  
    
    
<p id="alert_response" style="color:red"></p>
    <input type="button" name="Proceed" value="Proceed." onClick="process_response();">
    </form>
   
    </div>
    </div>

    
    <script language="javascript">
    <!--
    trial_begin();
    
    //-->
    </script>
    
<!---- ADDED THIS ---->
    
    <!--Contains all data to be passed on and saved in the form of hidden variables. -->    

		<!-- the new submit form for testmybrain.  Only uses two fields: results is all the results, and score is any kind of single metric for the test.
		All the other information about the test name and session and so on is handled by other parts of the tmb framework. -->

		<form id="form" action="/run" method="POST">
			<input type="hidden" id="data" name="data" />
			<input type="hidden" id="score" name="score" value="0" />
		</form>
<!--- TO HERE --->
		
    <div align="right" class="bottom"></div>
    
    </body>
    </html>
